! function(e) {
    e.fn.brushTool = function(e) {
        var t = this,
        tOffset = t.offset();
        t.unbind(), e.clicks = 0;
        var o, n, a, r, s = function() {
            t.drawLine({
                strokeWidth: e.stroke,
                strokeStyle: e.color,
                strokeCap: "round",
                strokeJoin: "round",
                x1: o,
                y1: n,
                x2: a,
                y2: r
            })
        };
        t.on(e.getTouchEventName("mousedown"), function(s) {
            if (e.hist.push(e.last.src = t[0].toDataURL("image/png")), e.undoHist.length = 0, !0 === e.press && (e.clicks = 0), 0 === e.clicks) {
                e.drag = !0;
                var c = e.getPageCoords(s);
                o = c.pageX - tOffset.left, n = c.pageY - tOffset.top, a = o, r = n, t.drawArc({
                    fillStyle: e.color,
                    x: o,
                    y: n,
                    radius: e.stroke / 2,
                    start: 0,
                    end: 360
                }), e.clicks += 1
            }
            s.preventDefault()
        }), t.on(e.getTouchEventName("mouseup"), function(o) {
            e.drag = !1, e.last.src = t[0].toDataURL("image/png"), e.clicks = 0, o.preventDefault()
        }), t.on(e.getTouchEventName("mousemove"), function(t) {
            if (!0 === e.drag && e.clicks >= 1) {
                o = a, n = r;
                var c = e.getPageCoords(t);
                a = c.pageX - tOffset.left, r = c.pageY - tOffset.top, s()
            }
            t.preventDefault()
        })
    }
}(jQuery);
